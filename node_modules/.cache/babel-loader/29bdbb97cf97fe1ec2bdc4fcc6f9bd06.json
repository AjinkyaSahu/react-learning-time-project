{"ast":null,"code":"import _regeneratorRuntime from\"/home/ajinkya/Resources/React/movie-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _toConsumableArray from\"/home/ajinkya/Resources/React/movie-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"/home/ajinkya/Resources/React/movie-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"/home/ajinkya/Resources/React/movie-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/ajinkya/Resources/React/movie-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useState,useEffect}from\"react\";import API from\"../API\";import{isPersistedState}from\"../helpers\";var initialState={page:0,results:[],total_pages:0,total_results:0};export var useHomeFetch=function useHomeFetch(){var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),searchTerm=_useState2[0],setSearchTerm=_useState2[1];var _useState3=useState(initialState),_useState4=_slicedToArray(_useState3,2),state=_useState4[0],setState=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),loading=_useState6[0],setLoading=_useState6[1];var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),error=_useState8[0],setError=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),isLoadingMore=_useState10[0],setIsLoadingMore=_useState10[1];var fetchMovies=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(page){var searchTerm,movies,_args=arguments;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:searchTerm=_args.length>1&&_args[1]!==undefined?_args[1]:\"\";_context.prev=1;setError(false);setLoading(true);_context.next=6;return API.fetchMovies(searchTerm,page);case 6:movies=_context.sent;setState(function(prev){return _objectSpread(_objectSpread({},movies),{},{results:page>1?[].concat(_toConsumableArray(prev.results),_toConsumableArray(movies.results)):_toConsumableArray(movies.results)});});console.log(state);_context.next=15;break;case 11:_context.prev=11;_context.t0=_context[\"catch\"](1);setError(true);console.log(_context.t0);case 15:setLoading(false);case 16:case\"end\":return _context.stop();}}},_callee,null,[[1,11]]);}));return function fetchMovies(_x){return _ref.apply(this,arguments);};}();useEffect(function(){if(!searchTerm){var sessionState=isPersistedState(\"homeState\");if(sessionState){console.log(\"Grabbing from sessionStorage\");setState(sessionState);return;}}console.log(\"Grabbing from API\");setState(initialState);fetchMovies(1,searchTerm);},[searchTerm]);// Load More\nuseEffect(function(){if(!isLoadingMore)return;fetchMovies(state.page+1,searchTerm);setIsLoadingMore(false);},[isLoadingMore,searchTerm,state.page]);// Write to sessionStorage\nuseEffect(function(){if(!searchTerm)sessionStorage.setItem(\"homeState\",JSON.stringify(state));},[searchTerm,state]);return{state:state,loading:loading,error:error,searchTerm:searchTerm,setSearchTerm:setSearchTerm,isLoadingMore:isLoadingMore,setIsLoadingMore:setIsLoadingMore};};","map":{"version":3,"sources":["/home/ajinkya/Resources/React/movie-app/src/hooks/useHomeFetch.js"],"names":["useState","useEffect","API","isPersistedState","initialState","page","results","total_pages","total_results","useHomeFetch","searchTerm","setSearchTerm","state","setState","loading","setLoading","error","setError","isLoadingMore","setIsLoadingMore","fetchMovies","movies","prev","console","log","sessionState","sessionStorage","setItem","JSON","stringify"],"mappings":"0xBAAA,OAASA,QAAT,CAAmBC,SAAnB,KAAoC,OAApC,CAEA,MAAOC,CAAAA,GAAP,KAAgB,QAAhB,CAEA,OAASC,gBAAT,KAAiC,YAAjC,CAEA,GAAMC,CAAAA,YAAY,CAAG,CACjBC,IAAI,CAAE,CADW,CAEjBC,OAAO,CAAE,EAFQ,CAGjBC,WAAW,CAAE,CAHI,CAIjBC,aAAa,CAAE,CAJE,CAArB,CAOA,MAAO,IAAMC,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,EAAM,CAC9B,cAAoCT,QAAQ,CAAC,EAAD,CAA5C,wCAAOU,UAAP,eAAmBC,aAAnB,eACA,eAA0BX,QAAQ,CAACI,YAAD,CAAlC,yCAAOQ,KAAP,eAAcC,QAAd,eACA,eAA8Bb,QAAQ,CAAC,KAAD,CAAtC,yCAAOc,OAAP,eAAgBC,UAAhB,eACA,eAA0Bf,QAAQ,EAAlC,yCAAOgB,KAAP,eAAcC,QAAd,eACA,eAA0CjB,QAAQ,CAAC,KAAD,CAAlD,0CAAOkB,aAAP,gBAAsBC,gBAAtB,gBAEA,GAAMC,CAAAA,WAAW,0FAAG,iBAAOf,IAAP,wJAAaK,UAAb,+CAA0B,EAA1B,iBAEZO,QAAQ,CAAC,KAAD,CAAR,CACAF,UAAU,CAAC,IAAD,CAAV,CAHY,sBAKSb,CAAAA,GAAG,CAACkB,WAAJ,CAAgBV,UAAhB,CAA4BL,IAA5B,CALT,QAKNgB,MALM,eAOZR,QAAQ,CAAC,SAACS,IAAD,wCACFD,MADE,MAELf,OAAO,CACHD,IAAI,CAAG,CAAP,8BACUiB,IAAI,CAAChB,OADf,qBAC2Be,MAAM,CAACf,OADlC,sBAEUe,MAAM,CAACf,OAFjB,CAHC,IAAD,CAAR,CAOAiB,OAAO,CAACC,GAAR,CAAYZ,KAAZ,EAdY,iFAgBZK,QAAQ,CAAC,IAAD,CAAR,CACAM,OAAO,CAACC,GAAR,cAjBY,QAoBhBT,UAAU,CAAC,KAAD,CAAV,CApBgB,qEAAH,kBAAXK,CAAAA,WAAW,4CAAjB,CAuBAnB,SAAS,CAAC,UAAM,CACZ,GAAI,CAACS,UAAL,CAAiB,CACb,GAAMe,CAAAA,YAAY,CAAGtB,gBAAgB,CAAC,WAAD,CAArC,CAEA,GAAIsB,YAAJ,CAAkB,CACdF,OAAO,CAACC,GAAR,CAAY,8BAAZ,EACAX,QAAQ,CAACY,YAAD,CAAR,CACA,OACH,CACJ,CACDF,OAAO,CAACC,GAAR,CAAY,mBAAZ,EACAX,QAAQ,CAACT,YAAD,CAAR,CACAgB,WAAW,CAAC,CAAD,CAAIV,UAAJ,CAAX,CACH,CAbQ,CAaN,CAACA,UAAD,CAbM,CAAT,CAeA;AACAT,SAAS,CAAC,UAAM,CACZ,GAAI,CAACiB,aAAL,CAAoB,OAEpBE,WAAW,CAACR,KAAK,CAACP,IAAN,CAAa,CAAd,CAAiBK,UAAjB,CAAX,CACAS,gBAAgB,CAAC,KAAD,CAAhB,CACH,CALQ,CAKN,CAACD,aAAD,CAAgBR,UAAhB,CAA4BE,KAAK,CAACP,IAAlC,CALM,CAAT,CAOA;AACAJ,SAAS,CAAC,UAAM,CACZ,GAAI,CAACS,UAAL,CACIgB,cAAc,CAACC,OAAf,CAAuB,WAAvB,CAAoCC,IAAI,CAACC,SAAL,CAAejB,KAAf,CAApC,EACP,CAHQ,CAGN,CAACF,UAAD,CAAaE,KAAb,CAHM,CAAT,CAKA,MAAO,CACHA,KAAK,CAALA,KADG,CAEHE,OAAO,CAAPA,OAFG,CAGHE,KAAK,CAALA,KAHG,CAIHN,UAAU,CAAVA,UAJG,CAKHC,aAAa,CAAbA,aALG,CAMHO,aAAa,CAAbA,aANG,CAOHC,gBAAgB,CAAhBA,gBAPG,CAAP,CASH,CApEM","sourcesContent":["import { useState, useEffect } from \"react\";\n\nimport API from \"../API\";\n\nimport { isPersistedState } from \"../helpers\";\n\nconst initialState = {\n    page: 0,\n    results: [],\n    total_pages: 0,\n    total_results: 0,\n};\n\nexport const useHomeFetch = () => {\n    const [searchTerm, setSearchTerm] = useState(\"\");\n    const [state, setState] = useState(initialState);\n    const [loading, setLoading] = useState(false);\n    const [error, setError] = useState();\n    const [isLoadingMore, setIsLoadingMore] = useState(false);\n\n    const fetchMovies = async (page, searchTerm = \"\") => {\n        try {\n            setError(false);\n            setLoading(true);\n\n            const movies = await API.fetchMovies(searchTerm, page);\n\n            setState((prev) => ({\n                ...movies,\n                results:\n                    page > 1\n                        ? [...prev.results, ...movies.results]\n                        : [...movies.results],\n            }));\n            console.log(state);\n        } catch (error) {\n            setError(true);\n            console.log(error);\n        }\n\n        setLoading(false);\n    };\n\n    useEffect(() => {\n        if (!searchTerm) {\n            const sessionState = isPersistedState(\"homeState\");\n\n            if (sessionState) {\n                console.log(\"Grabbing from sessionStorage\");\n                setState(sessionState);\n                return;\n            }\n        }\n        console.log(\"Grabbing from API\");\n        setState(initialState);\n        fetchMovies(1, searchTerm);\n    }, [searchTerm]);\n\n    // Load More\n    useEffect(() => {\n        if (!isLoadingMore) return;\n\n        fetchMovies(state.page + 1, searchTerm);\n        setIsLoadingMore(false);\n    }, [isLoadingMore, searchTerm, state.page]);\n\n    // Write to sessionStorage\n    useEffect(() => {\n        if (!searchTerm)\n            sessionStorage.setItem(\"homeState\", JSON.stringify(state));\n    }, [searchTerm, state]);\n\n    return {\n        state,\n        loading,\n        error,\n        searchTerm,\n        setSearchTerm,\n        isLoadingMore,\n        setIsLoadingMore,\n    };\n};\n"]},"metadata":{},"sourceType":"module"}